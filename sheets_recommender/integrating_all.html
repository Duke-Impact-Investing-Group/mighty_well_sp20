	<!-- Note from Aneesh:  -->
<!-- Right now printing to Console (Ctrl-F console.log) -->
<!-- Can change this to instead print on a screen/store easily -->

<form id="survey-form" action="">
  <div id = "container">
  <h1 id="title">Product Finder</h1>
  <div id="description">Answer the 4 questions below, and we will recommend a Mighty Well Product and blog posts just for you!</div>

  <!-- ------------------Gender---------------------------- -->
  <div class = "tab">
    <h3 class= "number"> - 1 - </h3>
    <h2 class = "question"> What is your gender? </h2><br>
    <div class="inputContainer">
    <p>
        <span class = "radio"><input type="radio" name="gender" value="male" >Male<br></span>
        <span class = "radio"><input type="radio" name="gender" value="female">Female<br></span>
        <span class = "radio"><input type="radio" name="gender" value="other">Other</span>
      </p>
    </div>
  </div>

   
  <!-- ------------------Medical Devices-------------------------------- -->
  <div class="tab">
      <h3 class="number"> - 2 - </h3>
      <h2 class="question"> What medical devices do you use?</h2><br>
      <label class = "checkbox-label">
      <span class="checkbox-custom">
        <p>
        <ul>
          <!--<input type="checkbox" name="meddev" value="diabeticPumps">Diabetic Pumps<br>-->
          <li><input type="checkbox" name="meddev" value="EpiPen (Allergies) ">EpiPen<br></li>
          <li><input type="checkbox" name="meddev" value="Diabetic Supplies">Diabetic Supplies<br></li>
          <!--input <input type="checkbox" name="meddev" value="hickmanLines">Hickman Lines (CVCs)<br> -->
          <!-- <input type="checkbox" name="meddev" value="inhalers">Inhalers<br> -->
          <li><input type="checkbox" name="meddev" value="Mastectomy Drains">Mastectomy Drains<br></li>
          <li><input type="checkbox" name="meddev" value="Midlines">Midlines<br></li>
          <li> <input type="checkbox" name="meddev" value="Peripheral I.V.s">Peripheral IVs<br></li>
          <li><input type="checkbox" name="meddev" value="PICCLines">PICC Lines<br></li>
         <!-- <li><input type="checkbox" name="meddev" value="Pills and Other Medications">Pills and Other Medications<br></li>-->
          <li><input type="checkbox" name="meddev" value="Port">Port<br></li>
          <li><input type="checkbox" name="meddev" value="TPN ">TPN<br></li>
          <li><input type="checkbox" name="meddev" value="Tube Feeding ">Feeding Tube<br></li>
          <!-- <input type="checkbox" name="meddev" value="vitamins">Vitamins<br> -->
          <li><input type="checkbox" name="meddev" value="Wheelchairs/Mobility Aids ">Wheelchairs/Mobility Aids<br></li>
          <li><input type="checkbox" name="meddev" value="Other">Other<br></li>
          </ul>
        </p>
      </span>
      </label>
  </div>

   <!-- ------------------Medical Condition-------------------------------- -->
   <div class = "tab">
    <h3 class = "number"> - 3 - </h3>
    <h2 class = "question"> Select all that apply to you! </h2> <br>
    <label class = "checkbox-label">
      <p>
      <ul>
       <li><input type="checkbox" name="medcon" value="aplasticAnemia">Aplastic Anemia<br></li>
       <li><input type="checkbox" name="medcon" value="behcets">Behcet's Syndrome<br></li>
       <li><input type="checkbox" name="medcon" value="caps">CAPS<br></li>
        <li><input type="checkbox" name="medcon" value="cysticFibrosis" >Cystic Fibrosis<br></li>
        <li><input type="checkbox" name="medcon" value="diabetes" >Diabetes<br></li>
        <li><input type="checkbox" name="medcon" value="dysautonomia">Dysautonomia<br></li>
        <li><input type="checkbox" name="medcon" value="eds">Ehlers-Danlos Syndrome (EDS)<br></li>
        <li><input type="checkbox" name="medcon" value="fibromyalgia">Fibromyalgia<br></li>
        <li><input type="checkbox" name="medcon" value="gp" >Gastroparesis (GP)<br></li>
        <li><input type="checkbox" name="medcon" value="hrt" >HRT<br></li>
        <li><input type="checkbox" name="medcon" value="lyme" >Lyme Disease<br></li>
        <li><input type="checkbox" name="medcon" value="marfan" >Marfan Syndrome<br></li>
        <li><input type="checkbox" name="medcon" value="mcas" >MCAS<br></li>
        <li><input type="checkbox" name="medcon" value="osteomyelitis">Osteomyelitis<br></li>
        <!--<li><input type="checkbox" name="medcon" value="partialEmptySella">Partial Empty Sella<br></li>-->
        <li><input type="checkbox" name="medcon" value="polyarthralgia">Polyarthralgia<br></li>
        <li><input type="checkbox" name="medcon" value="pcos" >Polycystic Ovary Syndrome (PCOS)<br></li>
        <li><input type="checkbox" name="medcon" value="pots" >Postural Orthostatic Tachycardia Syndrome (POTS)<br></li>
        <!-- <li><input type="checkbox" name="medcon" value="thyroidcancer" >Thyroid Cancer<br></li> -->
        <li><input type="checkbox" name="medcon" value="uc" >Ulcerative Colitis (UC)<br></li>
        <li><input type="checkbox" name="medcon" value="other" >Other<br></li>
        </ul>
      </p>
      </label>
</div>

  <!-- -----------------Use Case--------------------------------- -->

  <div class="tab">
      <h3 class="number"> - 4 - </h3>
      <h2 class="question"> What are you looking to use Mighty Well products for? </h2><br>
      <label class = "checkbox-label">
      <span class="checkbox-custom">
        <p>
        <ul>
          <li><input type="checkbox" name="usecase" value="antibioticInfusion">Antibiotic Infusion<br></li>
          <li><input type="checkbox" name="usecase" value="chemotherapy">Chemotherapy<br></li>
          <li><input type="checkbox" name="usecase" value="glucoseMonitoring">Glucose Monitoring<br></li>
          <li><input type="checkbox" name="usecase" value="holdMedicalSupplies">Hold Medical Supplies/Items<br></li>
          <li><input type="checkbox" name="usecase" value="IVInfusion">IV Infusion<br></li>
          <li><input type="checkbox" name="usecase" value="lookingGood">Looking Good/Feeling Proud!<br></li>
          <li><input type="checkbox" name="usecase" value="organizeMedications">Organize Medications<br></li>
          <li><input type="checkbox" name="usecase" value="raisingAwareness">Raising Awareness<br></li>
          <li><input type="checkbox" name="usecase" value="salineTreatment">Saline Treatment<br></li>
          <li><input type="checkbox" name="usecase" value="subcutaneousInjection">Subcutaneous Injection<br></li>
          <li><input type="checkbox" name="usecase" value="TPNInjection">TPN Injection<br></li>
          <li><input type="checkbox" name="usecase" value="transfusion">Transfusion<br></li>
          <li><input type="checkbox" name="usecase" value="tubeFeeding">Tube Feeding<br></li>
          <li><input type="checkbox" name="usecase" value="other">Other<br></li>
        </ul>
        </p>
      </span>
      </label>
  </div>

  <div class="tab results">
    <h1>Your Results!</h1>
    <section class = "blogContainer">
      <h3 style = "float: left;">Enjoy these Mighty Well products and specially curated blog posts just for you!</h3>
        <div class = "blog-image">
            <a href = "">
                <img src = "">
            </a>
        </div>
        <div class = "blog-name">
            <a href="">
                <h4></h4>
            </a>
        </div>
    </section>

    <section class="productContainer">
    </section>  
  </div>

  <div id="template">
	<br>
    <div id = "productCardTmp">
	<br>
      <div class="product-card">
		<br>
          <div class="product-image">
              <a href = ""> 
                <img src = "" class="try2"> 
              </a> 
          </div>
          <div class="product-info">
              <a href ="">
              <h5> </h5>
              </a>
          </div>
      </div>
    </div>
  </div>  
  

  <div style="overflow:auto;">
      <div style = "float:left;"></div>
          <p id="demo"></p>
          <div style = "text-align: center;">
          <button class ="formBtn" type="button" id="prevBtn" onclick="nextPrev(-1)">Previous</button>
          <button class ="formBtn" type="button" id="nextBtn" onclick="nextPrev(1)">Next</button>
          <button class ="formBtn" type="button" id="startOverBtn" onclick="location.reload()">Start Over</button>
          <button class = "formBtn" type="submit" id="finalsub" onclick="nextPrev(1)" form="survey-form" value="Submit">Get Your Results!</button>
      </div>
  </div>
  <!-- Circles which indicates the steps of the form: -->
  <div style="text-align:center;margin-top:40px;">
      <span class="step"></span>
      <span class="step"></span>
      <span class="step"></span>
      <span class="step"></span>
  </div>
</div>
</form>

  <style>
  /* Formating results page*/
    #template{
	display: none;
	}
	
	.template{
	display: grid;
	grid-template-columns: 1fr 1fr;
	grid-template-rows: 1fr 1fr;
	}

    .productCardTmp{
      width: 120px;
      height: 120px;
	  padding:40px; 
    }
	
	.productContainer{
      display: flex;
      flex-wrap: wrap;
    }

    @media (max-width: 920px) {
      .product-card {
        padding: 2%;
        flex-grow: 1;
        flex-basis: 30%
      }
    }

    @media screen and (min-width: 591px) {
      .product-image img{
      width: 100px;
	  height: 100px;
      float: right;
	  margin-left: auto;
		margin-right: auto;
      }}
	  
	  .try2{
	  width: 100px;
	  height: 100px;
      float: right;
	padding: 20px 
	  margin-left: auto;
		margin-right: auto;
	  }
	  

    .blog-name{
      float: right;
      font-size: 30;
    }

    .blog-image img {
      width: 100px;
	  height: 100px;
      float: right;
	  margin-left: auto;
		margin-right: auto;
		}

      ul {
        columns: 300px;
        list-style: none; 
      }

      p{
        margin:0 10px 0 10px;
        display: inline-block;
        text-align:left;
      }

      #regForm {
          background-color: #ffffff;
          margin: 100px auto;
          padding: 40px;
          width: 70%;
          min-width: 300px;
      }

     #container{
        background-color:#edf9fc;
        padding-top:100px;
        padding-bottom:100px;
        padding-right:150px;
        padding-left:150px;
      }

       /*#container{
        max-width:1050px;
        margin:0 auto;
        padding: 100px 15px;
        background-color:#edf9fc;
      }*/
	
      h1{
        margin-left:auto;
        margin-right:auto;
        text-align: center;
        font-size:35px;
      }

      h3{
        font-size:20;
      }

      #title .results{
        font-size: 0;
      }

      #description {
        text-align: center;
        padding:10px;
        max-width:400px;
        margin-left:auto;
        margin-right:auto;
        font: Lato;
        font-size: 14px;
        color: grey;
    }

    #description .results{
      display: none;
    }
	
	

      .radio{
        background-color: white;
        padding: 7px;
      }

      ul.checkbox  {
        margin-left: auto;
        background-color: color;
        margin-right:auto;
        list-style: none;
        }

      li{
        background-color: white;
        padding: 7px;
      }

      ul.checkbox li {
        border: 1px black;
        float: left;
        min-width: 400px;
      }

      .number {
          text-align: center;
      }

      .question{
          text-align: center;
          padding-top: 10px;
      }

      .inputContainer{
       text-align : center;
      }

      .formBtn{
         width: 10em;
         height: 2.2em;
         text-align: center;
         color: white;
         text-align:center;
         background-color: black;
      }

      /* Style the input fields */

      input {
          text-align: center;
          font-size: 17px;
          font-family: Raleway;
          padding-bottom: 20px;
      }

      /* Mark input boxes that gets an error on validation: */
      input.invalid {
          background-color: #ffdddd;
      }

      /* Hide all steps by default: */
      .tab {
          display: none;
      }

      /* Make circles that indicate the steps of the form: */
      .step {
          height: 15px;
          width: 15px;
          margin: 0 2px;
          background-color: #bbbbbb;
          border: none;
          border-radius: 50%;
          display: inline-block;
          opacity: 0.5;
      }

      /* Mark the active step: */
      .step.active {
          opacity: 1;
      }

      /* Mark the steps that are finished and valid: */
      .step.finish {
          background-color: #4CAF50;
      }
  </style>
  <!------------------SCRIPT---------------------------->
	<script src="https://code.jquery.com/jquery-1.6.4.js"></script>
  <script>
      const CATALOG ={
        "PICCPerfect ": ["https://mighty-well.com/products/picc-line-cover-piccperfect-mighty-well?_pos=5&_sid=db99fc554&_ss=r", "https://blog.mighty-well.com/2017/07/adapting-to-the-picc-life/"],
        "MedPlanner":  ["https://mighty-well.com/collections/all/products/mighty-medplanner-medical-organizer","https://blog.mighty-well.com/2019/06/trying-out-the-mighty-medplanner-your-new-medical-organizer/"],
        "Mighty Pack ": ["https://mighty-well.com/collections/all/products/medical-iv-infusion-backpack-for-patients","https://blog.mighty-well.com/2018/12/travel-without-worries-with-the-mighty-pack-the-best-backpack-for-friends-in-the-fight/"],
        "Mighty Wrap": ["https://mighty-well.com/collections/all/products/the-mighty-jacket","https://blog.mighty-well.com/2017/06/learning-to-love-your-tube/"],
        "Undefeated Wear":["https://mighty-well.com/collections/all/products/undefeated-t-shirt-heather-gray","https://blog.mighty-well.com/2019/11/mighty-well-fall-photoshoot/"]
      }

      const scriptURL = "https://script.google.com/macros/s/AKfycbxx4_QDeXS7AqXlU9WkYvDTvdY_dYHUMbZ-YdQK4SslU54ihug/exec"
      const form = document.forms[0]
      const proxyurl = "https://cors-anywhere.herokuapp.com/";


      form.addEventListener("submit", e => {
          e.preventDefault()
          fetch(scriptURL, {
              method: "POST",
              body: new FormData(form)
              })
              .then(response => console.log("Success!", response))
              .catch(error => console.error("Error!", error.message))
          })

      var currentTab = 0; // Current tab is set to be the first tab (0)
      var productRec = [];
      var gridTable = new Object;
      
      showTab(currentTab); // Display the current tab

      function showTab(n) {
          // This function will display the specified tab of the form ...
          var x = document.getElementsByClassName("tab");
          x[n].style.display = "block";
          // ... and fix the Previous/Next buttons:
          if(n == x.length-1){
            document.getElementById("prevBtn").style.display = "none";
            document.getElementById("nextBtn").style.display = "none";
            document.getElementById("finalsub").style.display = "none";
            document.getElementById("startOverBtn").style.display="inline";
          }
          else{
          document.getElementById("startOverBtn").style.display="none";

          if (n == 0) {
              document.getElementById("prevBtn").style.display = "none";
          } else {
              document.getElementById("prevBtn").style.display = "inline";
          }
          if (n == (x.length - 2)) {
              document.getElementById("finalsub").style.display = "inline";
              document.getElementById("nextBtn").style.display = "none";
          } else {
              document.getElementById("nextBtn").style.display = "inline";
              document.getElementById("finalsub").style.display = "none";

          }}
          // ... and run a function that displays the correct step indicator:
          fixStepIndicator(n)
      }

      function nextPrev(n) {
          // This function will figure out which tab to display
          var x = document.getElementsByClassName("tab");
          // Exit the function if any field in the current tab is invalid:
          if (n == 1 && !validateForm()) return false;
          // Hide the current tab:
          x[currentTab].style.display = "none";
          // Increase or decrease the current tab by 1:
          currentTab = currentTab + n;
          // if you have reached the end of the form... :
          if (currentTab >= x.length) {
              //...the form gets submitted:
              document.getElementById("demo").innerHTML = "check";
              //document.getElementById("survey-form").submit();
              return false;
          }

          if(currentTab==x.length-3){ // Last question page
              //document.getElementById("nextBtn").onclick = function() {calculateProduct();}
              
              //const result = await calculateProduct();
              //console.log("break 1");
              createProductPage();}
          // Otherwise, display the correct tab:
          showTab(currentTab);
      }

      function validateForm() {
          // This function deals with validation of the form fields
          var x, y, i, valid = false;
          x = document.getElementsByClassName("tab");
          y = x[currentTab].getElementsByTagName("input");
          for (i = 0; i < y.length; i++) {
            if (y[i].checked) {
              valid = true;
              break;
            }
          }
          console.log(valid);
          if (valid) {
              document.getElementsByClassName("step")[currentTab].className += " finish";
          }
          return valid; // return the valid status
      }

      function fixStepIndicator(n) {
          // This function removes the "active" class of all steps...
          var i, x = document.getElementsByClassName("step");
          for (i = 0; i < x.length+1; i++) {
              x[i].className = x[i].className.replace(" active", "");
          }
          //... and adds the "active" class to the current step:
          x[n].className += " active";
      }

      function calculateProduct() {
       // console.log("break 3");
          var deviceChecks = document.getElementsByName("meddev");
          var deviceUsed = [];
          for (i = 0; i < deviceChecks.length; i++) {
              // If a field is empty...
              if (deviceChecks[i].checked) {
                  deviceUsed.push(deviceChecks[i].value);
                 // document.getElementById("demo").innerHTML = "Device used: " + deviceUsed;
          }}
          console.log("Device used:" + deviceUsed);
          // https://api.jsonbin.io/b/5eb23bd48284f36af7b645fc
          let req = new XMLHttpRequest();

          req.onreadystatechange = () => {
              if (req.readyState == XMLHttpRequest.DONE) {
                  var jsonData = JSON.parse(req.responseText);
                  for(i = 0; i<deviceUsed.length;i++){
                    var prodList = jsonData[deviceUsed[i]];
                    for(var j = 0;j<prodList.length;j++){
                      productRec.push(prodList[j]);
                    }
                  console.log("Recommended device: "+ productRec);
                  console.log("All jSON Data: " + req.responseText);
              }}
          };
          req.open("GET", "https://api.jsonbin.io/b/5eb23bd48284f36af7b645fc/1", true);
          req.send();

          return new Promise(resolve => {
              setTimeout(() => {
                  resolve('resolved');
              }, 2000);
          });
      }

        function getProductInfo(url, productName){
        var urls = []; 
        $.get(proxyurl+url, function(data) { 
        gridTable[productName].push($('h1.product-single__title', data).html());
        var imgs = $('<div class= "product-single__photos" style="user-select: auto;">').html(data).find('img');
            imgs.each(function(i, img) {
            urls.push(img.src); 
            });
          
          gridTable[productName].push(urls[3]);
          });
           return new Promise(resolve => {
              setTimeout(() => {
                  resolve('resolved');
              }, 2000);
          });}

        function getBlogInfo(url, productName){
          var urls = []; 
          $.get(proxyurl+url, function(data) {
          gridTable[productName].push($('h1.post-title',data).html());         
          gridTable[productName].push($('div.post-image',data).find('a').attr('href'));
           return new Promise(resolve => {
              setTimeout(() => {
                  resolve('resolved');
              }, 2000);
          });});}

      function createGrid(){
        for(var i =0; i<Object.keys(gridTable).length; i++){
          var productName = productRec[i];
          var product = gridTable[productName];
          var productURL =  CATALOG[productName];
          console.log(productName);
		  console.log(product); 
          var node = document.getElementById("productCardTmp").cloneNode(true);
          node.id = productName;
          node.querySelector(".product-image img").setAttribute("src", product[1]);
		  console.log(product[1]); 
          node.querySelector(".product-image img").setAttribute("href", productURL[0]); //add link to image
          node.querySelector(".product-info h5").innerText = product[0];
          node.querySelector(".product-info a").setAttribute("href", productURL[0]); //add link to name
          document.querySelector(".productContainer").appendChild(node); //add new card 
        }
    }

    function createBlog(){
        var productName = productRec[0];
        var product = gridTable[productName];
        var productURL = CATALOG[productName];
        document.querySelector(".blog-image img").setAttribute("src", product[3]); // add blog image
        document.querySelector(".blog-image a").setAttribute("href", productURL[1]); // add blog url to image
        document.querySelector(".blog-name h4").innerText = product[2]; // add blog name
        document.querySelector(".blog-name a").setAttribute("href", productURL[1]); // add blog url to name
    }
       
        async function createProductPage(){
          await calculateProduct();
          for(var i=0; i<productRec.length;i++){
            var x = productRec[i];
            gridTable[x] = [];
            let productURLs = CATALOG[productRec[i]];
            await getProductInfo(productURLs[0],productRec[i]);
            await getBlogInfo(productURLs[1], productRec[i]);
          }
          
          console.log(gridTable);
          createBlog();
          createGrid();
          document.querySelector("#container").style.backgroundColor = "white";
          document.querySelector("#title").remove();
          document.querySelector("#description").remove();
      }
	  </script>
